# üéØ TASK: Service Hardening (Card & Direct Obligations)

> **Generated by:** Chief of Staff
> **Date:** 2025-12-17
> **Priority:** HIGH
> **Role:** FINTECH Architect
> **Objective:** Refactor `cardClearingService.ts` and `directObligationService.ts` to match the high-compliance pattern of `achClearingService.ts`.

---

## üìú Context
The `achClearingService.ts` is now the gold standard for Sovereign compliance. Both the **Card** and **Direct Obligation** services were partially refactored but need "Hardening" to ensure they are identical in their clearing-first logic and terminological precision.

## üõ†Ô∏è Files to Harden
- `ORACLE-LEDGER-main/services/cardClearingService.ts`
- `ORACLE-LEDGER-main/services/directObligationService.ts`

## üéØ Specific Objectives
1. **Unify Logic:** Ensure both services use the same `clearObligation()` call pattern as the ACH service.
2. **Remove Residuals:** Scan for and delete any remaining "payment," "refund," or "reversal" terms in variables, logs, or error messages.
3. **Atomic Error Handling:** Ensure external honors (Stripe API) are strictly optional and do not block the reporting of successful clearing.
4. **Finality Markers:** Add `CLEARING_FINALIZED` markers to all code paths that successfully clear an obligation.

## üö´ Constraints
- No logic changes outside of Sovereign compliance.
- Do not break the existing Drizzle/PostgreSQL narrative mirror logic.
- Use the **Universal Specialist Prompt** when executing.

## ‚úÖ Validation Criteria
- [ ] Both services pass the semantic violation scan.
- [ ] Manual walkthrough confirms `clearObligation()` occurs BEFORE external honors.
- [ ] All "reversal" logic is confirmed deleted.

---

### Handoff Instructions
1. State your specialization: **FINTECH Architect**.
2. Read the Master State Document (MSD).
3. Execute the hardening across both services.
4. Update the MSD session log with your changes.
